<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MapOrbis TileLayer Demo</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #map {
        width: 100vw;
        height: 100vh;
        background-color: #000;
      }
      #info {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 5px;
        font-family: sans-serif;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="info">
      <h3>TileLayer Demo</h3>
      <p>Loading OpenStreetMap tiles...</p>
    </div>
    <div id="map"></div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.171.0/build/three.module.js"
        }
      }
    </script>

    <script type="module">
      import {
        Map,
        TileLayer,
        TileSource,
        ProjectionFactory,
        Marker,
        PointLayer
      } from "./src/index.ts";

      // Initialize Map
      const map = new Map("map", {
        center: [116.4, 39.9, 20000], // Beijing, [lon, lat, height]
        basemap: {
          minLevel: 2,
          maxLevel: 19,
          Baselayers: [
            // Create OSM TileLayer
            new TileLayer("esri_imagery", {
              source: new TileSource({
                url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                projectionID: "3857",
              }),
              projection: ProjectionFactory.create("3857"),
              opacity: 1.0,
              visible: true,
            }),
          ],
        },
        viewer: {
          stats: true,
          antialias: true,
          skybox: {
            // path: "./example/public/image/skyboxall/onemap/",
            // files: [
            //   "posx.jpg",
            //   "negx.jpg",
            //   "posy.jpg",
            //   "negy.jpg",
            //   "posz.jpg",
            //   "negz.jpg",
            // ],
            hdr: "./example/public/image/hdr/kloofendal_48d_partly_cloudy_puresky_2k.hdr",
            hdrExposure: 1,
            defaultColor: "#B9D4FE", // 默认天空颜色
          },
        },
      });

      console.log("Map initialized:", map);

      map.on("loaded", () => {
        console.log("Map loaded event fired");
        document.querySelector("#info p").innerText =
          "Map loaded. Pan/Zoom to explore.";
      });

      const markersLayer = new PointLayer("markers", { altitude: 1 });
      map.addLayer(markersLayer);

      const marker = new Marker({
        geometry: {
          type: "Point",
          coordinates: [116.4, 39.9],
        },
        style: {
          type: "icon-point",
          url: "./example/public/image/cloud.png",
          size: 18,
          rotation: Math.PI / 4,
          anchor: [0.5, 0],
          sizeAttenuation: false,
          transparent: true,
          color: "#fff",
        },
        userData: {
          id: Date.now(),
          title:`标记点`,
          description:  "点击标记点查看详细信息",
          color:  "#007aff",
        },
      });

      marker.addTo(markersLayer);

    </script>
  </body>
</html>
