<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1.0, user-scalable=no, width=device-width"
    />
    <title>添加一个或多个覆盖物</title>
    <!-- 引入 MapOrbisStyle CSS -->
    <link rel="stylesheet" href="./example/css/orbisstyle.css" />
    <style>
      html,
      body,
      #container {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      /* 控制面板定位 */
      .orbis-control-panel {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 300px;
        z-index: var(--orbis-z-index-fixed);
      }

      /* 面板头部布局 - 标题和按钮在一行 */
      .orbis-panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--orbis-space-4) var(--orbis-space-5);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        background: rgba(255, 255, 255, 0.7);
      }

      .orbis-dark .orbis-panel-header {
        border-bottom-color: rgba(255, 255, 255, 0.1);
        background: rgba(44, 44, 46, 0.7);
      }

      .panel-header-content {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .panel-title {
        display: flex;
        align-items: center;
        gap: var(--orbis-space-2);
        font-size: 15px;
        font-weight: 600;
        margin: 0;
        color: var(--orbis-text-primary);
      }

      .orbis-dark .panel-title {
        color: var(--orbis-dark-text-primary);
      }

      .panel-subtitle {
        font-size: 12px;
        color: var(--orbis-gray-6);
        margin: 2px 0 0 0;
      }

      .orbis-dark .panel-subtitle {
        color: var(--orbis-dark-text-tertiary);
      }

      /* 切换按钮样式 */
      .orbis-toggle {
        margin-left: var(--orbis-space-3);
        flex-shrink: 0;
      }

      /* 按钮组样式调整 */
      .orbis-btn {
        flex: 1;
      }

      .orbis-btn-row {
        display: flex;
        gap: var(--orbis-space-2);
      }

      /* 响应式调整 */
      @media (max-width: 768px) {
        .orbis-control-panel {
          width: calc(100% - 40px);
          right: 20px;
          left: 20px;
        }
      }
    </style>
  </head>
  <body class="orbis-body">
    <div id="container"></div>

    <!-- MapOrbisStyle 控制面板 -->
    <div class="orbis-control-panel">
      <div class="orbis-panel orbis-shadow-lg">
        <div class="orbis-panel-header">
          <div class="panel-header-content">
            <h3 class="panel-title">
              <i
                class="fas fa-map-marker-alt"
                style="color: var(--orbis-blue)"
              ></i>
              添加覆盖物
            </h3>
            <p class="panel-subtitle">添加和管理地图覆盖物</p>
          </div>
          <button class="orbis-toggle" id="themeToggle" title="切换暗黑模式">
            <i class="fas fa-moon"></i>
          </button>
        </div>

        <div class="orbis-panel-body">
          <div class="orbis-btn-group orbis-mb-4">
            <div class="orbis-btn-row">
              <button class="orbis-btn orbis-btn-primary" id="addOneOverlay">
                <i class="fas fa-plus"></i>
                添加一个
              </button>
              <button
                class="orbis-btn orbis-btn-secondary"
                id="addSeveralOverlay"
              >
                <i class="fas fa-layer-group"></i>
                添加多个
              </button>
            </div>
          </div>

          <div class="orbis-status-card">
            <div class="orbis-status-title">状态</div>
            <div class="orbis-status-indicator orbis-mb-3">
              <span class="orbis-indicator" id="statusIndicator"></span>
              <div class="orbis-status-content" id="statusText">无覆盖物</div>
            </div>
            <div class="orbis-info-grid">
              <div class="orbis-info-item">
                <div class="orbis-info-label">覆盖物数量</div>
                <div class="orbis-info-value" id="overlayCount">0</div>
              </div>
              <div class="orbis-info-item">
                <div class="orbis-info-label">最后操作</div>
                <div class="orbis-info-value" id="lastOperation">--</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 引入 Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.171.0/build/three.module.js"
        }
      }
    </script>
    <script type="module">
      import * as maporbis from "./src/index.ts";
      // 创建地图实例
      var map = new maporbis.Map("container", {
        state: {
          center: [116.4, 39.9, 20000], // Beijing, [lon, lat, height]
        },
        source: {
          minLevel: 2,
          maxLevel: 19,
          baseLayers: [
            new maporbis.WMTSTileLayer("esri_imagery", {
              source: new maporbis.TileSource({
                url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                projectionID: "3857",
              }),
              projection: maporbis.ProjectionFactory.create("3857"),
              opacity: 1.0,
              visible: true,
              altitude: 1,
            }),
          ],
        },
        renderer: {
          stats: true,
          antialias: true,
          skybox: {
            hdr: "/example/public/image/hdr/kloofendal_48d_partly_cloudy_puresky_2k.hdr",
            hdrExposure: 1,
            defaultColor: "#B9D4FE", // 默认天空颜色
          },
          minDistance: 20,
          maxDistance: 80000,
          defaultGround: {
            enabled: false,
            visible: true,
            color: "#ff0000",
            opacity: 1,
          },
        },
        camera: {
          pitch: 75,
          bearing: 0,
        },
      });

      const point = new maporbis.Marker({
        geometry: {
          type: "Point",
          coordinates: [116.4, 39.9], // Beijing coordinates with altitude
        },
        paint: {
          type: "icon",
          url: "https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",
          size: 32,
          sizeAttenuation: false,
          transparent: true,
          anchor:[0.5, 0], // Using named anchor instead of [0, 0]
        },
      });

      // 创建线覆盖物
      var polyline = new maporbis.LineString({
        geometry: {
          type: "LineString",
          coordinates: [
            [116.41, 39.93],
            [116.43, 39.91],
          ],
        },
        paint: {
          type: "line",
          color: "#ff0000",
          width: 5,
          opacity: 1,
        },
      });

      // 创建面覆盖物
      var polygon = new maporbis.Polygon({
        geometry: {
          type: "Polygon",
          coordinates: [
            [
              [116.46, 39.93],
              [116.44, 39.91],
              [116.49, 39.91],
               [116.46, 39.93],
            ],
          ],
        },
        paint: {
          type: "fill",
          color: "#ff0000",
          opacity: 0.5,
        },
      });

      var markerlayer = new maporbis.PointLayer("markers", { altitude: 0});
      var polylinelayer = new maporbis.LineLayer("polylines", {
        altitude: 5,
      });
      var polygonlayer = new maporbis.PolygonLayer("polygons", { altitude: 1 });

      map.addLayer([markerlayer, polylinelayer, polygonlayer]);

      var addOneOverlayButton = document.getElementById("addOneOverlay");
      var addSeveralOverlayButton =
        document.getElementById("addSeveralOverlay");
      var themeToggle = document.getElementById("themeToggle");

      let overlayCount = 0;
      let isDarkMode = false;

      // 更新状态
      function updateStatus() {
        const statusIndicator = document.getElementById("statusIndicator");
        const statusText = document.getElementById("statusText");
        const overlayCountEl = document.getElementById("overlayCount");
        const lastOperationEl = document.getElementById("lastOperation");

        if (overlayCount > 0) {
          statusIndicator.className = "orbis-indicator orbis-indicator-active";
          statusText.textContent = "已添加覆盖物";
        } else {
          statusIndicator.className = "orbis-indicator";
          statusText.textContent = "无覆盖物";
        }

        overlayCountEl.textContent = overlayCount;
      }




      // 绑定添加一个覆盖物事件
      addOneOverlayButton.onclick = function () {
        try {
          point.addTo(markerlayer);
          overlayCount++;
          document.getElementById("lastOperation").textContent = "添加点覆盖物";
          updateStatus();
    
        } catch (error) {
  
        }
      };

      // 绑定添加多个覆盖物事件
      addSeveralOverlayButton.onclick = function () {
        try {
          polyline.addTo(polylinelayer);
          polygon.addTo(polygonlayer);
          overlayCount += 2;
          document.getElementById("lastOperation").textContent =
            "添加线和面覆盖物";
          updateStatus();
          // showNotification("线和面覆盖物添加成功", "success");
        } catch (error) {
          console.error(error);
          // showNotification("添加失败: " + error.message, "error");
        }
      };


    </script>
  </body>
</html>
