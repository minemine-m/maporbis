<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1.0, user-scalable=no, width=device-width"
    />
    <style>
      html,
      body,
      #container {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .input-card {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 120px;
        z-index: 1000;
        background: white;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      .btn {
        display: block;
        width: 100%;
        padding: 8px 12px;
        margin-bottom: 5px;
        background: #007cff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .btn:hover {
        background: #0056cc;
      }
    </style>
    <title>多边形的绘制和编辑 - MapOrbis</title>
  </head>
  <body>
    <div id="container"></div>
    <div class="input-card">
      <button class="btn" onclick="startEdit()" style="margin-bottom: 5px">
        开始编辑
      </button>
      <button class="btn" onclick="endEdit()">结束编辑</button>
    </div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.171.0/build/three.module.js"
        }
      }
    </script>
    <script type="module">
      import * as maporbis from "./src/index.ts";

      // 创建地图实例
      var map = new maporbis.Map("container", {
        state: {
          center: [116.400274, 39.905812, 5000000],
        },
        source: {
          minLevel: 2,
          maxLevel: 19,
          baseLayers: [
            new maporbis.WMTSTileLayer("esri_imagery", {
              source: new maporbis.TileSource({
                url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                projectionID: "3857",
              }),
              projection: maporbis.ProjectionFactory.create("3857"),
              opacity: 1.0,
              visible: true,
              altitude: 1,
            }),
          ],
        },
        renderer: {
          stats: true,
          antialias: true,
          skybox: {
            hdr: "/example/public/image/hdr/kloofendal_48d_partly_cloudy_puresky_2k.hdr",
            hdrExposure: 1,
            defaultColor: "#B9D4FE",
          },
          minDistance: 20,
          maxDistance: 80000,
          defaultGround: {
            enabled: false,
            visible: true,
            color: "#ff0000",
            opacity: 1,
          },
        },
        camera: {
          pitch: 75,
          bearing: 0,
        },
      });

      // 多边形坐标数据
      var path = [
        [116.403322, 39.920255],
        [116.410703, 39.897555],
        [116.402292, 39.892353],
        [116.389846, 39.891365],
      ];

      var path1 = [
        [116.453322, 39.920255],
        [116.460703, 39.897555],
        [116.452292, 39.892353],
        [116.439846, 39.891365],
      ];

      // 创建多边形图层
      const polygonLayer = new maporbis.PolygonLayer("polygons", {
        altitude: 1,
      });
      map.addLayer(polygonLayer);

      // 创建第一个多边形
      var polygon = new maporbis.Polygon({
        geometry: {
          type: "Polygon",
          coordinates: [path],
        },
        paint: {
          type: "fill",
          color: "#1791fc",
          opacity: 1,
        },
        editable: true,
      });

      // 创建第二个多边形
      var polygon1 = new maporbis.Polygon({
        geometry: {
          type: "Polygon",
          coordinates: [path1],
        },
        paint: {
          type: "fill",
          color: "#1791fc",
          opacity: 1,
        },
        editable: true,
      });

      // 添加多边形到图层
      polygon.addTo(polygonLayer);
      polygon1.addTo(polygonLayer);


      window.startEdit = function () {
        console.log("开始编辑");
        polygon.startEdit({
          handleSize: 12,
          handleColor: "#1890FF",
          showMiddleHandles: false,
        });
        // polygon1.startEdit();
      }

     window.endEdit = function () {
        polygon.endEdit();
        // polygon1.endEdit();
      }
    </script>
  </body>
</html>